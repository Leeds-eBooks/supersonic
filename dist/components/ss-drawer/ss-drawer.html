<style>
ss-drawer {
  display: none;
}
</style>

<script>
(function() {
  var SSDrawerPrototype, observer, onStyleChanged;

  onStyleChanged = function(node) {
    if (node.isHidden()) {
      return node.hideDrawer();
    } else {
      return node.showDrawer();
    }
  };

  observer = new MutationObserver(function(mutations) {
    var mutation, _i, _len, _ref, _results;
    _results = [];
    for (_i = 0, _len = mutations.length; _i < _len; _i++) {
      mutation = mutations[_i];
      if (mutation.type === "attributes" || ((_ref = mutation.attributeName) === "style" || _ref === "class")) {
        _results.push(onStyleChanged(mutation.target));
      }
    }
    return _results;
  });

  SSDrawerPrototype = Object.create(HTMLElement.prototype);

  SSDrawerPrototype.createdCallback = function() {
    this.location = this.getAttribute("location");
    this.side = this.getAttribute("side");
    this.drawer = new steroids.views.WebView(this.location);
    return this._preloaded = false;
  };

  SSDrawerPrototype._preload = function(callback) {
    var preload, that;
    that = this;
    preload = function(callback) {
      return that.drawer.preload({}, {
        onSuccess: function() {
          that._preloaded = true;
          return callback.apply(that);
        }
      });
    };
    return steroids.getApplicationState({}, {
      onSuccess: function(state) {
        var loaded;
        loaded = false;
        state.preloads.forEach(function(p) {
          return loaded = loaded || (p.id.indexOf(that.location) !== -1);
        });
        if (!loaded) {
          return preload(callback);
        } else {
          return callback.apply(that);
        }
      }
    });
  };

  SSDrawerPrototype.showDrawer = function() {
    var that;
    that = this;
    return this._preload(that._openDrawer);
  };

  SSDrawerPrototype._openDrawer = function() {
    var drawer, params, side;
    side = this.side;
    drawer = this.drawer;
    params = {};
    params[side] = drawer;
    steroids.drawers.update(params);
    return steroids.drawers.show({
      edge: steroids.screen.edges[side.toUpperCase()]
    });
  };

  SSDrawerPrototype.hideDrawer = function() {};

  SSDrawerPrototype.isHidden = function() {
    var style;
    style = window.getComputedStyle(this);
    if (style.display === "none" || style.visibility === "hidden") {
      return true;
    }
  };

  SSDrawerPrototype.attachedCallback = function() {
    var observerConfiguration;
    observerConfiguration = {
      attributes: true,
      attributeFilter: ["style", "class"]
    };
    observer.observe(this, observerConfiguration);
    return onStyleChanged(this);
  };

  SSDrawerPrototype.detachedCallback = function() {
    return observer.disconnect();
  };

  document.registerElement("ss-drawer", {
    prototype: SSDrawerPrototype
  });

}).call(this);

</script>